{"ast":null,"code":"var _jsxFileName = \"/Users/yokohamakaito/Desktop/chatAppFirebase/src/dashboard/dashboard.js\";\nimport React from \"react\";\nimport ChatList from \"../chatList/chatList\";\nimport { Button, withStyles } from \"@material-ui/core\";\nimport styles from \"./style\";\nimport ChatViewComponent from '../chatview/chatView';\nimport ChatTextBox from '../chattextbox/chattextbox';\n\nconst firebase = require(\"firebase\");\n\nclass DashbordComponent extends React.Component {\n  constructor() {\n    super();\n\n    this.signOut = () => firebase.auth().signOut();\n\n    this.selectChat = chatIndex => {\n      this.setState({\n        selectChat: chatIndex\n      });\n      console.log({\n        selectChat: chatIndex\n      }, chatIndex);\n    };\n\n    this.submitMessage = msg => {\n      console.log(1111);\n      console.log(this.state.newChatFormVisible);\n      console.log(1111);\n      const docKey = this.buildDocKey(this.state.chats[this.state.selectChat].users.filter(_usr => _usr !== this.state.email)[0]);\n      console.log(docKey);\n      firebase.firestore().collection('chat').doc(docKey).set({\n        messages: firebase.firestore.FieldValue.arrayUnion({\n          sender: this.state.email,\n          message: msg\n        }),\n        receiverHasRead: false\n      });\n    };\n\n    this.buildDocKey = friend => [this.state.email, friend].sort().join(':');\n\n    this.newChatBtnClicked = () => this.setState({\n      newChatFormVisible: true,\n      selectChat: null\n    });\n\n    this.componentDidMount = () => {\n      firebase.auth().onAuthStateChanged(async _user => {\n        if (!_user) this.props.history.push(\"/login\");else {\n          await firebase.firestore().collection(\"chats\").where(\"users\", \"array-contains\", _user.email).onSnapshot(async res => {\n            const chats = res.docs.map(_doc => _doc.data());\n            await this.setState({\n              email: _user.email,\n              chats: chats\n            });\n            console.log(this.state);\n          });\n        }\n      });\n    };\n\n    this.state = {\n      selectChat: null,\n      newChatFormVisible: false,\n      email: null,\n      chats: []\n    };\n  }\n\n  render() {\n    const {\n      classes\n    } = this.props;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 21,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(ChatList, {\n      history: this.props.history,\n      newChatBtnFn: this.newChatBtnClicked,\n      selectChatFn: this.selectChat,\n      chats: this.state.chats,\n      userEmail: this.state.email,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 22,\n        columnNumber: 9\n      }\n    }, \" \"), this.state.newChatFormVisible ? null : /*#__PURE__*/React.createElement(ChatViewComponent, {\n      user: this.state.email,\n      chat: this.state.chats[this.state.selectChat],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 34,\n        columnNumber: 13\n      }\n    }), this.state.selectChat !== null && !this.state.newChatFormVisible ? /*#__PURE__*/React.createElement(ChatTextBox, {\n      submitMessageFn: this.submitMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 41,\n        columnNumber: 11\n      }\n    }) : null, /*#__PURE__*/React.createElement(Button, {\n      className: classes.signOutBtn,\n      onClick: this.signOut,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 43,\n        columnNumber: 9\n      }\n    }, \"Sign Out\"));\n  }\n\n}\n\nexport default withStyles(styles)(DashbordComponent);","map":{"version":3,"sources":["/Users/yokohamakaito/Desktop/chatAppFirebase/src/dashboard/dashboard.js"],"names":["React","ChatList","Button","withStyles","styles","ChatViewComponent","ChatTextBox","firebase","require","DashbordComponent","Component","constructor","signOut","auth","selectChat","chatIndex","setState","console","log","submitMessage","msg","state","newChatFormVisible","docKey","buildDocKey","chats","users","filter","_usr","email","firestore","collection","doc","set","messages","FieldValue","arrayUnion","sender","message","receiverHasRead","friend","sort","join","newChatBtnClicked","componentDidMount","onAuthStateChanged","_user","props","history","push","where","onSnapshot","res","docs","map","_doc","data","render","classes","signOutBtn"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport ChatList from \"../chatList/chatList\";\nimport { Button, withStyles } from \"@material-ui/core\";\nimport styles from \"./style\";\nimport ChatViewComponent from '../chatview/chatView'\nimport ChatTextBox from '../chattextbox/chattextbox'\nconst firebase = require(\"firebase\");\nclass DashbordComponent extends React.Component {\n  constructor() {\n    super();\n    this.state = {\n      selectChat: null,\n      newChatFormVisible: false,\n      email: null,\n      chats: []\n    };\n  }\n  render() {\n    const { classes } = this.props;\n    return (\n      <div>\n        <ChatList\n          history={this.props.history}\n          newChatBtnFn={this.newChatBtnClicked}\n          selectChatFn={this.selectChat}\n          chats={this.state.chats}\n          userEmail={this.state.email}\n        >\n          {\" \"}\n        </ChatList>\n        {\n            this.state.newChatFormVisible? \n            null:\n            <ChatViewComponent\n                user={this.state.email}\n                chat={this.state.chats[this.state.selectChat]}\n            ></ChatViewComponent>\n        }\n        {\n          this.state.selectChat !== null && !this.state.newChatFormVisible?\n          <ChatTextBox submitMessageFn={this.submitMessage}/>:null\n        }\n        <Button className={classes.signOutBtn} onClick={this.signOut}>\n          Sign Out\n        </Button>\n      </div>\n    );\n  }\n  signOut= () =>firebase.auth().signOut();\n\n  selectChat = chatIndex => {\n    this.setState({selectChat:chatIndex})\n    console.log({selectChat:chatIndex},chatIndex)\n  };\n\n  submitMessage = (msg) => {\n    console.log(1111)\n    console.log(this.state.newChatFormVisible)\n    console.log(1111)\n    const docKey = this.buildDocKey(this.state.chats[this.state.selectChat]\n      .users\n      .filter(_usr => _usr !== this.state.email)[0])\n      console.log(docKey)\n    firebase\n      .firestore()\n      .collection('chat')\n      .doc(docKey)\n      .set({\n        messages: firebase.firestore.FieldValue.arrayUnion({\n          sender: this.state.email,\n          message: msg,\n        }),\n        receiverHasRead: false\n      });\n  }\n  buildDocKey = (friend) =>[this.state.email,friend].sort().join(':')\n\n  newChatBtnClicked = () =>\n    this.setState({ newChatFormVisible: true, selectChat: null });\n\n  componentDidMount = () => {\n    firebase.auth().onAuthStateChanged(async _user => {\n      if (!_user) this.props.history.push(\"/login\");\n      else {\n        await firebase\n          .firestore()\n          .collection(\"chats\")\n          .where(\"users\", \"array-contains\", _user.email)\n          .onSnapshot(async res => {\n            const chats = res.docs.map(_doc => _doc.data());\n            await this.setState({\n              email: _user.email,\n              chats: chats\n            });\n            console.log(this.state);\n          });\n      }\n    });\n  };\n}\n\nexport default withStyles(styles)(DashbordComponent);\n"]},"metadata":{},"sourceType":"module"}