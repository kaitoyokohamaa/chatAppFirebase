{"ast":null,"code":"import _regeneratorRuntime from\"/Users/yokohamakaito/Desktop/chatFirebase/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/yokohamakaito/Desktop/chatFirebase/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/yokohamakaito/Desktop/chatFirebase/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/yokohamakaito/Desktop/chatFirebase/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _createSuper from\"/Users/yokohamakaito/Desktop/chatFirebase/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _inherits from\"/Users/yokohamakaito/Desktop/chatFirebase/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React from'react';import{FormControl,InputLabel,Input,Button,Paper,withStyles,CssBaseline,Typography}from'@material-ui/core';import styles from'./styles';var firebase=require(\"firebase\");var NewChatComponent=/*#__PURE__*/function(_React$Component){_inherits(NewChatComponent,_React$Component);var _super=_createSuper(NewChatComponent);function NewChatComponent(){var _this;_classCallCheck(this,NewChatComponent);_this=_super.call(this);_this.userTyping=function(type,e){switch(type){case'username':_this.setState({username:e.target.value});break;case'message':_this.setState({message:e.target.value});break;default:break;}};_this.submitNewChat=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var userExists,chatExists;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.next=3;return _this.userExists();case 3:userExists=_context.sent;console.log(userExists);if(!userExists){_context.next=10;break;}_context.next=8;return _this.chatExists();case 8:chatExists=_context.sent;chatExists?_this.goToChat():_this.createChat();case 10:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.createChat=function(){_this.props.newChatSubmitFn({sendTo:_this.state.username,message:_this.state.message});};_this.goToChat=function(){_this.props.goToChatFn(_this.buildDocKey(),_this.state.message);};_this.buildDocKey=function(){return[firebase.auth().currentUser.email,_this.state.username].sort().join(':');};_this.chatExists=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var docKey,chat;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:docKey=_this.buildDocKey();_context2.next=3;return firebase.firestore().collection('chats').doc(docKey).get();case 3:chat=_context2.sent;console.log(2222);console.log(chat.exists);console.log(2222);return _context2.abrupt(\"return\",chat.exists);case 8:case\"end\":return _context2.stop();}}},_callee2);}));_this.userExists=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var usersSnapshot,exists;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return firebase.firestore().collection('users').get();case 2:usersSnapshot=_context3.sent;exists=usersSnapshot.docs.map(function(_doc){return _doc.data().email;}).includes(_this.state.username);_this.setState({serverError:!exists});return _context3.abrupt(\"return\",exists);case 6:case\"end\":return _context3.stop();}}},_callee3);}));_this.state={username:null,message:null};return _this;}_createClass(NewChatComponent,[{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;return/*#__PURE__*/React.createElement(\"main\",{className:classes.main},/*#__PURE__*/React.createElement(CssBaseline,null,/*#__PURE__*/React.createElement(Paper,{className:classes.paper},/*#__PURE__*/React.createElement(Typography,{component:\"h1\",variant:\"h5\"},\"Send A Message\"),/*#__PURE__*/React.createElement(\"form\",{className:classes.form,onSubmit:function onSubmit(e){return _this2.submitNewChat(e);}},/*#__PURE__*/React.createElement(FormControl,{fullWidth:true},/*#__PURE__*/React.createElement(InputLabel,{htmlFor:\"new-chat-username\"},\"Enter Your Friend's Email\"),/*#__PURE__*/React.createElement(Input,{required:true,className:classes.input,autoFocus:true,onChange:function onChange(e){return _this2.userTyping('username',e);},id:\"new-chat-username\"})),/*#__PURE__*/React.createElement(FormControl,{fullWidth:true},/*#__PURE__*/React.createElement(InputLabel,{htmlFor:\"new-chat-message\"},\"Enter Your Message\"),/*#__PURE__*/React.createElement(Input,{required:true,className:classes.input,autoFocus:true,onChange:function onChange(e){return _this2.userTyping('message',e);},id:\"new-chat-message\"}),/*#__PURE__*/React.createElement(Button,{fullWidth:true,className:classes.submit,variant:\"contained\",color:\"primary\",type:\"submit\"},\" Submit\"))))));}// }\n}]);return NewChatComponent;}(React.Component);export default withStyles(styles)(NewChatComponent);","map":{"version":3,"sources":["/Users/yokohamakaito/Desktop/chatFirebase/src/newChat/newChat.js"],"names":["React","FormControl","InputLabel","Input","Button","Paper","withStyles","CssBaseline","Typography","styles","firebase","require","NewChatComponent","userTyping","type","e","setState","username","target","value","message","submitNewChat","preventDefault","userExists","console","log","chatExists","goToChat","createChat","props","newChatSubmitFn","sendTo","state","goToChatFn","buildDocKey","auth","currentUser","email","sort","join","docKey","firestore","collection","doc","get","chat","exists","usersSnapshot","docs","map","_doc","data","includes","serverError","classes","main","paper","form","input","submit","Component"],"mappings":"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","sourcesContent":["  \nimport React from 'react';\nimport { FormControl, InputLabel, Input, Button, Paper, withStyles, CssBaseline, Typography } from '@material-ui/core';\nimport styles from './styles';\nconst firebase = require(\"firebase\");\n\nclass NewChatComponent extends React.Component{\n\n    constructor(){\n        super();\n        this.state = {\n            username:null,\n            message:null\n        }\n    }\n\n    render(){\n        const {classes} = this.props\n        return (\n           <main className={classes.main}>\n               <CssBaseline>\n                   <Paper className={classes.paper}>\n                       <Typography component=\"h1\" variant=\"h5\">\n                            Send A Message\n                       </Typography>\n                       <form className={classes.form} onSubmit={(e) =>this.submitNewChat(e)}>\n                            <FormControl fullWidth>\n                                <InputLabel htmlFor=\"new-chat-username\">\n                                    Enter Your Friend's Email\n                                </InputLabel>\n                                <Input required\n                                className={classes.input}\n                                autoFocus\n                                onChange={(e) =>this.userTyping('username',e)}\n                                id='new-chat-username'\n                                >\n                                </Input>\n                            </FormControl>\n                            <FormControl fullWidth> \n                                <InputLabel htmlFor=\"new-chat-message\">\n                                    Enter Your Message\n                                </InputLabel>\n                                 <Input required\n                                className={classes.input}\n                                autoFocus\n                                onChange={(e) =>this.userTyping('message',e)}\n                                id='new-chat-message'\n                                ></Input>\n                                <Button fullWidth className={classes.submit} variant=\"contained\" color='primary' type=\"submit\"> Submit</Button>\n                            </FormControl>\n                       </form>\n                   </Paper>\n               </CssBaseline>\n           </main>\n        )\n    }\n\n    userTyping = (type,e) =>{\n        switch(type) {\n            case 'username':\n                this.setState({username:e.target.value})\n             break;\n            case 'message':\n                this.setState({message:e.target.value})\n             break;\n            default:\n            break\n        }\n    }\n    submitNewChat = async(e) =>{\n        e.preventDefault();\n        const userExists=  await this.userExists();\n        console.log(userExists)\n        if(userExists){\n            const chatExists = await this.chatExists();\n            chatExists ? this.goToChat () :this.createChat();\n        }\n    }\n\n    createChat = () =>{\n        this.props.newChatSubmitFn({\n            sendTo :this.state.username,\n            message:this.state.message\n        })\n    }\n\n    goToChat = () =>{\n        this.props.goToChatFn(\n            this.buildDocKey(),\n            this.state.message\n        )\n    }\n  \n    buildDocKey = () => [firebase.auth().currentUser.email, this.state.username].sort().join(':');\n\n    chatExists = async () =>{\n        const docKey = this.buildDocKey(); \n        const chat = await firebase\n         .firestore()\n         .collection('chats')\n         .doc(docKey)\n         .get();\n         console.log(2222)\n         console.log(chat.exists)\n         console.log(2222)\n         return chat.exists\n    }\n    userExists = async () => {\n        const usersSnapshot = await \n        firebase\n          .firestore()\n          .collection('users')\n          .get();\n        const exists = usersSnapshot\n          .docs\n            .map(_doc => _doc.data().email)\n            .includes(this.state.username);\n        this.setState({ serverError: !exists });\n        return exists;\n      }\n// }\n    }\nexport default withStyles(styles)(NewChatComponent);"]},"metadata":{},"sourceType":"module"}